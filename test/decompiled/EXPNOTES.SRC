; Decompiled from 
; Fields: 96, Labels: 9, Instructions: 131

define NLUPLINE type A size 150
define TXTSYNLUP_HNDL type I size 5
define TSYNOTE_HNDL type I size 5
define FILELOC_HNDL type I size 5
define SIZE type I size 5
define DESC type A size 40
define FD_NAME type A size 8
define ACTUAL_FILE type A size 8
define BUFF_NAME type A size 8
define FILE_NAME type A size 60
define CREATE_FILE type A size 60
define COMP_CODE type A size 3
define BKSYNLUP_HNDL type I size 5 reset
define BKSYNOTE_HNDL type I size 5 reset
define DES_HNDL type I size 5
define COLOR_HNDL type I size 5 reset
define NORM_HLDR type I size 5
define PRG_HDR_NAME type A size 36
define PRG_HDR_PRG type A size 22
define PRG_HDR_LINE type A size 80
define PRG_HDR_CV type A size 21
define CURRENT_PRG type A size 22 reset
define CURRENT_VER type A size 5 reset
define MESSAGE type A size 78 array 16
define MSG_PTR type P size 35
define STAT_BAR_HNDL type I size 5
define WNDWDT type I size 2
define BTOTSOFAR type I size 2
define BCNTR type I size 5
define BARXPOS type I size 5
define BARWDT type I size 5
define RECSDONE type I size 5
define TEMPDIFF type I size 5
define PERC type I size 5
define CNTR_VAL type I size 5
define WCHGRPHC type I size 5
define WCHCOLOR type I size 5
define BTOTRECS type N size 6
define BARVAL type N size 11 dec 8
define BTEMPHLDR type N size 11 dec 8
define CHRVAL type I size 3
define USEFILENUM type L size 3
define CREATE_FILE type A size 60
define FD_NAME type A size 8
define CREATE_SPECS type A size 667

  udc LABEL_1
  color 
  openv 'BKSYNLUP.TXT' fnum TXTSYNLUP_HNDL buf NLUPLINE size 150 create
  openv 'BKSYNLUP' fnum BKSYNLUP_HNDL
  openv 'BKSYNOTE' fnum BKSYNOTE_HNDL
  openv 'filedes' ext 'B' fnum DES_HNDL path dpath()
  openv 'fileloc' fnum FILELOC_HNDL lock R
  COMP_CODE = 'B'+co()
  ACTUAL_FILE = 'TSYNOTE'
  BUFF_NAME = 'BKSYNOTE'
  DESC = 'Temporary Note File'
  SIZE = 83
  gosub LABEL_2
  openv 'tsynote' fnum TSYNOTE_HNDL lock R
  trap '"' ?0x49:0
  udc LABEL_3
  window at 5,4 len 3 wdt 70 ttlw 'l' ttl 'Exporting BKSYNLUP' box 's'
  udc LABEL_4
  scan 78
  udc LABEL_5
  NLUPLINE = BKNOTE.CODE+','+dtoc(BKNOTE.DATE)+','+ttoc(BKNOTE.TIME)+','+BKNOTE.WHO+','+BKNOTE.SH.NOTE+','+dtoc(BKNOTE.INT.DATE)+','+ttoc(BKNOTE.INT.TIME)+','+BKNOTE.WHR.FROM
  save TXTSYNLUP_HNDL nocnf
  window at 5,8 len 3 wdt 70 ttlw 'l' ttl 'Saving BKSYNOTE records to temporary file' box 's'
  udc LABEL_4
  scan 78
  udc LABEL_5
  save TSYNOTE_HNDL nocnf
  msg 'Export Done.'
LABEL_5:
  quit
LABEL_1:
  findv M fnum FILELOC_HNDL key 2 val ACTUAL_FILE, COMP_CODE
  if flerr(FILELOC_HNDL)<>0 do
  LOC_LOCATION = ''
  LOC_COMP_CODE = 'B'
  LOC_FILE_NAME = ACTUAL_FILE
  LOC_BUFF_NAME = BUFF_NAME
  LOC_REC_TYPE = 'T'
  LOC_DESCRIPTION = DESC
  LOC_REC_SIZE = SIZE
  save FILELOC_HNDL
  else
  delf ACTUAL_FILE+'.'+COMP_CODE
  FILE_NAME = LOC_FILE_NAME
  FD_NAME = LOC_BUFF_NAME
  gosub LABEL_7
  ret
LABEL_6:
  CREATE_FILE = FILE_NAME+'.'+COMP_CODE
  if CREATE_FILE or LABEL_8(FD_NAME,CREATE_FILE) do
  msg 'Error initializing temporary data files.'
  quit
  clr FILELOC_HNDL
  ret
  quit
LABEL_0:
  cmd LABEL_1
  if COLOR_HNDL=0 do
  if ffile('tascolor.ovl','f')<>'' do
  openv 'tascolor.ovl' fnum COLOR_HNDL
  else
  openv 'tascolor.ovl' fnum COLOR_HNDL path tpath()
  findv F fnum COLOR_HNDL
  else
  ropen COLOR_HNDL
  color NORM
  color 
  NORM_HLDR = NORM
  udc LABEL?9
  clrscr
  ret
LABEL_2:
  cmd LABEL_3
  PRG_HDR_LINE = ' Business Tools'
  mid PRG_HDR_LINE = 21,,CONST@1151
  mid PRG_HDR_LINE = 58,,CONST@1156
  if PRG_HDR_PRG='' do
  PRG_HDR_CV = CURRENT_PRG+''+CURRENT_VER
  else
  PRG_HDR_CV = PRG_HDR_PRG+''+CURRENT_VER
  mid PRG_HDR_LINE = 59,,justify(PRG_HDR_CV,'r')
  mid PRG_HDR_LINE = 22,,justify(PRG_HDR_NAME,'c')
  ? 1,1,CONST@1347
  ret
LABEL_8:
  cmd LABEL?9
  MSG_PTR = MESSAGE[1]
  ret
LABEL_3:
  cmd LABEL_4
  if USEFILENUM do
  BTOTRECS = crec(STAT_BAR_HNDL)
  else
  BTOTRECS = STAT_BAR_HNDL
  BARWDT = WNDWDT-8
  BARVAL = BARWDT*BTOTRECS
  BARXPOS = 1
  RECSDONE = 0
  BTEMPHLDR = 0
  BTOTSOFAR = 0
  ret
LABEL_4:
  cmd LABEL_5
  inc RECSDONE
  PERC = RECSDONE*BTOTRECS+100
  ? 1,WNDWDT-CONST@1611,CONST@1601
  BTEMPHLDR = BTEMPHLDR+BARVAL
  CNTR_VAL = BARVAL
  BTOTSOFAR = BTOTSOFAR+CNTR_VAL
  TEMPDIFF = BTEMPHLDR-BTOTSOFAR
  if TEMPDIFF>=1 do
  BTOTSOFAR = BTOTSOFAR+TEMPDIFF
  CNTR_VAL = CNTR_VAL+TEMPDIFF
  if (CNTR_VAL>0) and BARXPOS<=BARWDT do
  BCNTR = 1
  endif
  for BCNTR =  to CNTR_VAL
  ? 1,BARXPOS,'XP\a'
  inc BARXPOS
  next
  if RECSDONE=BTOTRECS do
  while BARXPOS-1<BARWDT
  ? 1,BARXPOS,CONST@1995
  inc BARXPOS
  endw
  ret
LABEL_7:
  func LABEL_8
  findv M fnum DES_HNDL key 1 val CONST@2020
  if flerr(DES_HNDL)<>0 do
  msg 'The FD:'+FD_NAME+' is not in FILEDES.B.  It needs to be there before using this program to initialize data files.'
  quit
  xfer DES_INFORMATION to CREATE_SPECS
  inifle CREATE_FILE
  ret .F.
