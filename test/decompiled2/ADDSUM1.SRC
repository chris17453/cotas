DEFINE BKSYMSTR_HNDL, I, 5
DEFINE BKARCUST_HNDL, I, 5
DEFINE PAGE_NUM, I, 5
DEFINE RPT_DATE, D, 8
DEFINE RPT_TIME, T, 7
DEFINE HEADER_LINE, R, 10
DEFINE QUIT_LINE, R, 10
DEFINE TOT_RECS, R, 6
DEFINE FROM_SEL_FLD1, A, 10
DEFINE THRU_SEL_FLD1, A, 10
DEFINE FROM_SEL_FLD2, A, 2
DEFINE THRU_SEL_FLD2, A, 2
DEFINE FROM_SEL_FLD3, A, 2
DEFINE THRU_SEL_FLD3, A, 2
DEFINE FROM_SEL_FLD4, I, 3
DEFINE THRU_SEL_FLD4, I, 3
DEFINE FROM_SEL_FLD5, D, 8
DEFINE THRU_SEL_FLD5, D, 8
DEFINE FILTER_EXPR, A, 128
DEFINE BKAR.CUSTCODE, A, 10
DEFINE BKAR.STATE, A, 2
DEFINE BKAR.CLASS, A, 2
DEFINE BKAR.SLSP.NUM, I, 3
DEFINE BKAR.START.DATE, D, 8
DEFINE PRG_HDR_NAME, A, 51
DEFINE PRG_HDR_PRG, A, 16
DEFINE PRG_HDR_LINE, A, 80
DEFINE PRG_HDR_CV, A, 21
DEFINE CUR_COMP_NAME, A, 25
DEFINE REV, I, 3
DEFINE PL_CNTR, B, 3
DEFINE BKSYNLUP_HNDL, I, 5
DEFINE BKSYNOTE_HNDL, I, 5
DEFINE LKUP_FULL_SCRN, A, 1
DEFINE COLOR_HNDL, I, 5
DEFINE NORM, I, 3
DEFINE HIGH, I, 3
DEFINE ERR, I, 3
DEFINE ENTER, I, 3
DEFINE NORM_HLDR, I, 5
DEFINE BKHELP_HNDL, I, 5
DEFINE EHL_FLD, A, 15
DEFINE EHL_PRG, A, 8
DEFINE DHL_DUMMY, L, 3
DEFINE LASER_PRINTER, L, 3
DEFINE BKSYPRTR_PATH, A, 60
DEFINE BKSYPRTR_HNDL, I, 5
DEFINE WC, I, 3
DEFINE BC, I, 3
DEFINE SC, I, 3
DEFINE BKSY.PRTR.NAME, A, 30
DEFINE CC, I, 3
DEFINE DATC, I, 3
DEFINE BKSY.PRTR.EXEC, A, 8
DEFINE BKSY.PRTR.TAS, A, 1
DEFINE BKSY.PRGS.WHR, A, 40
DEFINE BKSY.PRTR.TYPE, A, 8
DEFINE BKSY.PRTR.LPTNM, B, 1
DEFINE BKSY.PRTR.PWDT, I, 3
DEFINE BKSY.PRTR.PMAX, I, 3
DEFINE BKSY.PRTR.PPLNE, I, 3
DEFINE BKSY.PRTR.LASER, A, 1
DEFINE FC, I, 3
DEFINE LOGON.CHR, A, 1
DEFINE DO_PASSWORDS, L, 3
DEFINE ALREADY_ENTERED, L, 3
DEFINE LOGON_SCTY, A, 1
DEFINE LOGON_FLAGS, A, 1
DEFINE LOGON_DOS_OK, A, 1
DEFINE IMF_DONE, L, 3
DEFINE MESSAGE, A, 78, 16
DEFINE MSG_PTR, P, 35
DEFINE DO_HELP_FIELD, A, 15
DEFINE DO_HELP_PRG, A, 8
DEFINE DO_HELP_DESC, A, 30
DEFINE DH_LCTR, I, 5
DEFINE BKHELP_HELP_LNE, A, 60
DEFINE BKHELP_FIELD, A, 15
DEFINE BKHELP_PRG, A, 8
DEFINE BKHELP_LINE_CTR, I, 3
DEFINE CPC_FLD, A, 60
DEFINE CPC_FLDS, I, 5
DEFINE CPC_LOC, I, 5
DEFINE DP_SCRN, A, 1
DEFINE DP_COLS, I, 5
DEFINE DP_CNTR, I, 5
DEFINE DP_CNTR1, I, 5
DEFINE DP_CNTR2, I, 5
DEFINE DP_CNTR3, I, 5
DEFINE DP_ROW, I, 5
DEFINE LOC_ACT, I, 5
DEFINE DP_FLD, A, 255
DEFINE DP_DONE, L, 3
DEFINE DP_FORCE, L, 3
DEFINE STRT_COL, I, 5
DEFINE CHR, I, 5
DEFINE DUMMY, L, 3
DEFINE BKAR.CUSTNAME, A, 30
DEFINE BKAR.ADD1, A, 30
DEFINE BKAR.CITY, A, 15
DEFINE BKAR.ZIP, A, 10
DEFINE BKAR.TELEPHONE, A, 25

LABEL_1
OPENV 'bksymstr', N, BKSYMSTR_HNDL
FINDV F, BKSYMSTR_HNDL, -2104164097, LABEL_0
CLRSCR
LABEL_2 'Customer name/address/phone list'
RPT_DATE = DATE()
RPT_TIME = TIME()
OPENV 'BKARCUST', N, BKARCUST_HNDL
PMSG 'Limit output by the following selection fields:' AT 10,5
PMSG 'From BKAR.CUSTCODE:' AT 10,7
PMSG 'Thru BKAR.CUSTCODE:' AT 10,8
PMSG 'From BKAR.STATE:' AT 10,9
PMSG 'Thru BKAR.STATE:' AT 10,10
PMSG 'From BKAR.CLASS:' AT 10,11
PMSG 'Thru BKAR.CLASS:' AT 10,12
PMSG 'From BKAR.SLSP.NUM:' AT 10,13
PMSG 'Thru BKAR.SLSP.NUM:' AT 10,14
PMSG 'From BKAR.START.DATE:' AT 10,15
PMSG 'Thru BKAR.START.DATE:' AT 10,16
UPAR LABEL_0
ENTER 32, 7, FROM_SEL_FLD1
ENTER 32, 8, THRU_SEL_FLD1, THRU_SEL_FLD1>=FROM_SEL_FLD1, DFLT=FROM_SEL_FLD1, VMSG='The Thru BKAR.CUSTCODE cannot be less than the From BKAR.CUSTCODE'
ENTER 32, 9, FROM_SEL_FLD2
ENTER 32, 10, THRU_SEL_FLD2, THRU_SEL_FLD2>=FROM_SEL_FLD2, DFLT=FROM_SEL_FLD2, VMSG='The Thru BKAR.STATE cannot be less than the From BKAR.STATE'
ENTER 32, 11, FROM_SEL_FLD3
ENTER 32, 12, THRU_SEL_FLD3, THRU_SEL_FLD3>=FROM_SEL_FLD3, DFLT=FROM_SEL_FLD3, VMSG='The Thru BKAR.CLASS cannot be less than the From BKAR.CLASS'
ENTER 32, 13, FROM_SEL_FLD4
ENTER 32, 14, THRU_SEL_FLD4, THRU_SEL_FLD4>=FROM_SEL_FLD4, DFLT=FROM_SEL_FLD4, VMSG='The Thru BKAR.SLSP.NUM cannot be less than the From BKAR.SLSP.NUM'
ENTER 32, 15, FROM_SEL_FLD5
ENTER 32, 16, THRU_SEL_FLD5, THRU_SEL_FLD5>=FROM_SEL_FLD5, DFLT=FROM_SEL_FLD5, VMSG='The Thru BKAR.START.DATE cannot be less than the From BKAR.START.DATE'
SAVES
PUSHT
TRAP f3,f4,f5,f6,f7,f8,f9,f10 IGNR
WINDOW 8, 17, 3, 62, ' Enter the desired record filter ', 'l', 'd', 'r'
ENTER 1, 1, FILTER_EXPR, 'The expression entered here will be used to determine which records are displayed in this report.'
POPT
REDSP
MOUNT REPORT, A
TRAP INT GOTO LABEL_3
GETLBL LABEL_3, QUIT_LINE
LABEL_3:
BKAR.CUSTCODE = FROM_SEL_FLD1
PAGE_NUM = 0
IF PWHR()<>'S'
      IF PWHR()='P' THEN
   LABEL_5
   PCHR 'init'
   ASK 'Print in condensed mode? Y'
      IF ASK() THEN
   PCHR 'pcmp'
   PSET 132
ENDIF
   IF .NOT. LABEL_6(IIF(TEMP0='S',255,PSET('w')),HEADER_LINE,QUIT_LINE) GOTO LABEL_3
TRAP PERR GOSUB LABEL_7
GOSUB LABEL_8
SCAN BKARCUST_HNDL, 1, BKAR.CUSTCODE
      IF .NOT. LABEL_9(GFL(5)) GOTO LABEL_3
   TOT_RECS = TOT_RECS+1
ENDS
   IF PSET('p')<IIF(TEMP0='S',ROW(),PROW())+1 THEN
PTOF
   IF .NOT. LABEL_9(GFL(6)) GOTO LABEL_3
   IF .NOT. LABEL_9(GFL(7)) GOTO LABEL_3
LABEL_2:
LABEL_10
TRAP PERR DFLT
IF PWHR()<>'S'
   PTOF
   PCHR 'preg'
   PSET 80
      IF PWHR()='P' THEN
   EXEC ' '
ENDIF
QUIT
LABEL_6:
GOSUB LABEL_8
RET
LABEL_7:
INC PAGE_NUM
   IF .NOT. LABEL_9(GFL(1)) GOTO LABEL_3
   IF .NOT. LABEL_9(GFL(2)) GOTO LABEL_3
   IF .NOT. LABEL_9(GFL(3)) GOTO LABEL_3
   IF .NOT. LABEL_9(GFL(4)) GOTO LABEL_3
RET
   IF .NOT. LABEL_9(GFL(5)) GOTO LABEL_3
TOT_RECS = TOT_RECS+1
RET
LABEL_1:
CMD LABEL_2(PRG_HDR_NAME, PRG_HDR_PRG)
PRG_HDR_LINE = ' '+CUR_COMP_NAME
MID 'Â³', 28, PRG_HDR_LINE
MID JUST(PRG_HDR_NAME,'c'), 29, PRG_HDR_LINE
PMSG PRG_HDR_LINE AT 1,1 NOCR COLOR REV
RET
LABEL_0:
CMD LABEL_1
LABEL_11
BKSYNLUP_HNDL = BKSYNLUP_HNDL
BKSYNOTE_HNDL = BKSYNOTE_HNDL
IF COLOR_HNDL=0
   IF FFILE('tascolor.ovl','f')<>''
      OPENV 'tascolor.ovl', N, COLOR_HNDL
   ELSE
      OPENV 'tascolor.ovl', N, COLOR_HNDL
   ENDIF
   FINDV F, COLOR_HNDL, LABEL_0
ELSE
   ROPEN COLOR_HNDL
ENDIF
COLOR NORM
NORM_HLDR = NORM
IF BKHELP_HNDL=0
   OPENV 'bkhelp', 'B', N, BKHELP_HNDL
ELSE
   ROPEN BKHELP_HNDL
ENDIF
LABEL_12
CLRSCR
TRAP KEY_0x6C GOSUB LABEL_13
TRAP f1 GOSUB LABEL_14
RET
LABEL_12:
EHL_FLD = VARREAD()
SAVES
CHAIN 'bkhelp'
REDSP
RET
LABEL_13:
EHL_FLD = VARREAD()
DHL_DUMMY = LABEL_15(EHL_FLD,EHL_PRG,'')
RET
LABEL_15:
CMD LABEL_16
XTRAP S
TRAP KEY_0x6C GOSUB LABEL_13
TRAP f1 GOSUB LABEL_14
RET
LABEL_4:
CMD LABEL_5
BKSYPRTR_PATH = GETENV('BKPRINT')
IF BKSYPRTR_PATH<>''
   BKSYPRTR_PATH = LABEL_17(BKSYPRTR_PATH,60)
   OPENV 'bksyprtr', 'B', N, BKSYPRTR_HNDL
ELSE
   OPENV 'bksyprtr', 'B', N, BKSYPRTR_HNDL
ENDIF
IF TRC(BKSYPRTR_HNDL)=0
   CLOSE BKSYPRTR_HNDL
   RET
ENDIF
IF TRC(BKSYPRTR_HNDL)>1
   SAVES
   WINDOW 23, 15, 10, 34, WC, ' Choose Printer ', 'l', 's', 'r'
   LISTF BKSY.PRTR.NAME, BKSYPRTR_HNDL, 1, CC
   REDSP
      IF BKSY.PRTR.NAME='' RET
ELSE
   FINDV F, BKSYPRTR_HNDL, 1, LABEL_0
ENDIF
IF BKSY.PRTR.EXEC<>''
   IF BKSY.PRTR.TAS='Y'
      CHAIN BKSY.PRGS.WHR+BKSY.PRTR.EXEC
   ELSE
      EXEC BKSY.PRGS.WHR+BKSY.PRTR.EXEC
   ENDIF
ENDIF
LD_PDRV BKSY.PRTR.TYPE
PRT_NUM BKSY.PRTR.LPTNM
PSET BKSY.PRTR.PWDT
LASER_PRINTER = .F.
IF BKSY.PRTR.LASER='Y'
   LASER_PRINTER = .T.
   PCHR '66lns'
   PSET 132
ENDIF
CLOSE BKSYPRTR_HNDL
RET
LABEL_17:
FUNC LABEL_18
RET
LABEL_10:
CMD LABEL_11
IF LOGON.CHR<>'z'
   MSG 'You cannot run this program directly.  You must run the Main Menu first.  Do this by typing ADV at the DOS prompt then ENTER.', NOWAIT
   QUIT
ENDIF
RET
LABEL_11:
CMD LABEL_12
   IF IMF_DONE THEN
RET
MSG_PTR -> MESSAGE[1]
IMF_DONE = .T.
RET
LABEL_14:
FUNC LABEL_15(DO_HELP_FIELD, DO_HELP_PRG, DO_HELP_DESC)
DO_HELP_FIELD = UP(DO_HELP_FIELD)
DO_HELP_PRG = UP(DO_HELP_PRG)
IF BKHELP_HNDL=0
   OPENV 'bkhelp', 'B', N, BKHELP_HNDL
   IF OPEN()<>0
      MSG 'There is no help file.', NOWAIT
      RET
   ENDIF
ENDIF
FINDV M, BKHELP_HNDL, 1, DO_HELP_FIELD, DO_HELP_PRG, 0, LABEL_0
IF FLERR(BKHELP_HNDL)<>0
   MSG 'There is no help available for this option.', NOWAIT
   RET
ENDIF
DH_LCTR = VAL(GFLD(1,,,BKHELP_HELP_LNE))
   IF DO_HELP_DESC='' THEN
DO_HELP_DESC = GFLD(2,,,BKHELP_HELP_LNE)
SAVES
WINDOW 6, 23-IIF(DH_LCTR<=10,DH_LCTR,10), IIF(DH_LCTR<=10,DH_LCTR+2,12), 66, ERR, IIF(DO_HELP_DESC<>'',' Help For: '+TEMP0+' ',' Help '), 'l', 's', 'r'
LISTF BKHELP_HELP_LNE, BKHELP_HNDL, 1, BKHELP_LINE_CTR>0, (BKHELP_FIELD=DO_HELP_FIELD) .AND. BKHELP_PRG=DO_HELP_PRG
REDSP
RET
LABEL_16:
FUNC LABEL_17(CPC_FLD, CPC_FLDS)
CPC_LOC = LCHR(CPC_FLD,'l')
IF (LCHR(CPC_FLD)<>'\') .AND. CPC_LOC<>0
   MID '\', IIF(CPC_LOC+1<=CPC_FLDS,CPC_LOC+1,CPC_FLDS), CPC_FLD
ENDIF
RET
LABEL_5:
FUNC LABEL_6(DP_COLS)
IF PWHR()='S'
   ALLOC DP_SCRN, 'a', DP_COLS, 22
   IF SIZE(DP_SCRN,'d')<>DP_COLS
      MSG 'There is not enough memory to display this report to the screen.  Try sending it to the printer.', NOWAIT
      DEALOC DP_SCRN
      RET
   ENDIF
   CLRSCR
ENDIF
DP_ROW = 0
RET
LABEL_8:
FUNC LABEL_9(DP_FLD, DP_FORCE)
PUSHT
TRAP INT GOTO LABEL_19
IF PWHR()='S'
   INC DP_ROW
   DP_SCRN[DP_ROW] = DP_FLD
   PMSG DP_FLD
   IF DP_ROW=22 .OR. DP_DONE .OR. DP_FORCE
      LOC_ACT = 0
      DP_CNTR = 1
   ENDW
   FOR DP_CNTR = ; DP_ROW
      LOC_ACT = MAX(SIZE(DP_SCRN[DP_CNTR],'a'),LOC_ACT)
   ENDW
NEXT
IF LOC_ACT<=80
   MSG 'Press any key to continue.', NOWAIT
      IF ESC() GOTO LABEL_19
ELSE
   PMSG LABEL_18(), CHR(26), ' 1 chr right   ', CHR(27), ' 1 chr left   ^', CHR(26), ' 40 chrs right   ^', CHR(27), ' 40 chrs left   Home / End    ', CCF() AT 1,24 NOCR
   PMSG LABEL_18(), 'Press Enter for next page     Press ESC to quit   Current Col:                       ', CCF() AT 1,25 NOCR
   STRT_COL = 1
   LOC_ACT = LOC_ACT+2
   CURSOR
   WHILE .T.
      PMSG LABEL_18(), STRT_COL, CCF() AT 65,25 NOCR
      DISPF DP_SCRN, STRT_COL, 80, DP_ROW, 1, 1
      PMSG '' AT 1,1 NOCR
      CHR = INKEY('w')
      IF CHR=333
         IF STRT_COL+1<=LOC_ACT-80
            INC STRT_COL
         ELSE
            STRT_COL = LOC_ACT-80
         ENDIF
      ELSE
         IF CHR=372
            IF STRT_COL+40<=LOC_ACT-80
               STRT_COL = STRT_COL+40
            ELSE
               STRT_COL = LOC_ACT-80
            ENDIF
         ELSE
            IF CHR=331
               IF STRT_COL>1
                  DEC STRT_COL
               ELSE
                  STRT_COL = 1
               ENDIF
            ELSE
               IF CHR=371
                  IF STRT_COL>40
                     STRT_COL = STRT_COL-40
                  ELSE
                     STRT_COL = 1
                  ENDIF
               ELSE
                  IF CHR=327
                     STRT_COL = 1
                  ELSE
                     IF CHR=335
                        STRT_COL = LOC_ACT-80
                     ELSE
                        IF CHR=13
                           CURSOR
                        ELSE
                        ELSE
                           IF CHR=27
                              CURSOR
                              GOTO LABEL_19
                           ENDIF
                        ENDIF
                     ENDIF
                  ENDIF
               ENDIF
            ENDIF
         ENDIF
      ENDIF
   ENDW
ENDIF
CLRSCR
UPDTA DP_SCRN, CLR
DP_ROW = 0
DP_FORCE = .F.
   IF .NOT. DP_DONE THEN
GOSUB LABEL_7
ENDIF
ELSE
   IF SIZE(DP_FLD,'a')<=PSET('w')
      PMSG DP_FLD
   ELSE
      WRAP DP_FLD, PSET('w')-3, 10
      DP_CNTR = 1
   ENDW
   FOR DP_CNTR = ; 10
      EXIT_IF WRAPS(DP_CNTR)=0
   ENDW
NEXT
   IF PROW()+DP_CNTR>=PSET('p') THEN
PTOF
DP_CNTR = 1
ENDW
FOR DP_CNTR = ; 10
   EXIT_IF WRAPS(DP_CNTR)=0
   IF DP_CNTR=1
      PMSG WRAPL(DP_CNTR)
   ELSE
      PMSG '   ', WRAPL(DP_CNTR)
   ENDIF
ENDW
ENDIF
ENDIF
NEXT
LABEL_19:
POPT
RET
LABEL_18:
IF PWHR()='S'
   DP_ROW = 0
   DEALOC DP_SCRN
ENDIF
POPT
RET
LABEL_9:
CMD LABEL_10
   IF PWHR()<>'S' RET
IF DP_ROW>0
   DP_DONE = .T.
   DUMMY = LABEL_9('')
   DP_DONE = .F.
ENDIF
DEALOC DP_SCRN
RET
QUIT

;End of Prg
\B5FORMAT1
      Date:                      CUSTOMER ADDRESS LIST              Page:

Cust code   Customer name                   Address                       City            ST   ZIP       Phone
==========  ============================== ============================== =============== == ========== =========================


Total records:
\FIELDS
RPT_DATE         0 14  0  0  0 0    8    0    0DNNGMEMORY  NN     8
PAGE_NUM         0 75  0  0  0 0    5    0    0INNGMEMORY  NN     5
BKAR.CUSTCODE    0  1  4  0  0 0   10    0    0AYRGBKARCUST      10
BKAR.CUSTNAME    0 13  4  0  0 0   30    0    0ANRGBKARCUST      30
BKAR.ADD1        0 44  4  0  0 0   30    0    0ANRGBKARCUSTNN    30
BKAR.CITY        0 75  4  0  0 0   15    0    0ANRGBKARCUSTNN    15
BKAR.STATE       0 91  4  0  0 0    2    0    0AYRGBKARCUST       2
BKAR.ZIP         0 94  4  0  0 0   10    0    0AYRGBKARCUST      10
BKAR.TELEPHONE   0 105  4  0  0 0   25    0    0ANRGBKARCUSTNN    25
TOT_RECS         0 16  6  0  0 0    6    0    0RNNGMEMORY  NN     6
\\
