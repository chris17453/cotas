    setup_color
    color array norm
    trap f2,f3,f4,f5,f6,f7,f8,f9,f10 ignr
    if .n. chk_for_logon() then quit  &&AMF 9/5/00 ADDSUM
    define list_term_hndl type i local size 5
    define bksyterm_hndl type I size 5 
    openv 'bksyterm' lock n fnum bksyterm_hndl
    if .n. open_symsts() then quit
    define vend_rec_hold type a size 1
    define hold.vend type a size 10 up
    define from_bkarcref type L reset
    define bkarcust_hndl type I size 5 reset
    define type type i size 1
    define OK type A size 1
    define new_vend type l
    define dsp_wch type i
    define VENDCODE.HLDR type A size 10
    define in_bkpoa,vend_rec_chgd type l reset
    define MCNTR,MCNTR2,MCNTR3,MCNTR4 type i size 5
    define chain_frm type l
    param bkapvend_hndl
    trap l_exit goto l_exit
    define bkapvend_clblv,bkapaddr_clblv,bkapcont_clblv type r
    getlbl bkapvend_clbl fld bkapvend_clblv
    getlbl bkapaddr_clbl fld bkapaddr_clblv
    getlbl bkapcont_clbl fld bkapcont_clblv
    define read_only type L
    read_only=.f.
    if bkapvend_hndl=0 .a. bksys.ap.lock="Y"
       ask 'Look at vendor information only? Y' 
       if ask()
         openv 'bkapvend' fnum bkapvend_hndl lock n
         openv 'bkapaddr' fnum bkapaddr_hndl lock n
         openv 'bkapcont' fnum bkapcont_hndl lock n
         read_only=.t.
         goto ADDSUM1
      endif
    endif
    if bkapvend_hndl<>0
        ropen bkapvend_hndl update ask_update2('Vendor Master File',bkapvend_clblv)
        chain_frm=.t.
    else
        openv 'bkapvend' fnum bkapvend_hndl lock R update ask_update2('Vendor Master File',bkapvend_clblv)
    endif
    openv 'bkapaddr' fnum bkapaddr_hndl lock r update ask_update2('Vendor Address File',bkapaddr_clblv)
    openv 'bkapcont' fnum bkapcont_hndl lock r update ask_update2('Vendor Contact File',bkapcont_clblv)
    if from_bkarcref
       if bkarcust_hndl=0
          msg 'Unable to find customer file handle.'
       else          
          ropen bkarcust_hndl
       endif
    endif
   ADDSUM1:pdesc
    openv 'bkaprivl' fnum bkaprivl_hndl lock n
    openv 'bkapinvl' fnum bkapinvl_hndl lock n
    openv 'bkapchkh' fnum bkapchkh_hndl lock n
    openv 'bkappo' fnum bkappo_hndl lock n
    openv 'bkglcoa'  fnum bkglcoa_hndl lock n
   if read_only  &&ADDSUM
    openv 'BKSYMSTR' fnum bksymstr_hndl lock n
   else
    openv 'BKSYMSTR' fnum bksymstr_hndl lock r
        bksy.chk.4.chgs=.F.
        if .n. chain_frm
          dall @bkapvend_hndl key bkap.vendcode start '' while bkap.vendcode=''
          clr @bkapvend_hndl
        endif
   endif
    findv F fnum bksymstr_hndl key @0 nlock
    if flerr(bksymstr_hndl)<>0 then goto EXIT
    ehl_prg='BKAPA'
    trap ESC goto EXIT
    trap f5,f6,f7,f8,f9 dflt
    format BKAP.OUTINV nofd
    format BKAP.OUT.CREDIT nofd
    format BKAP.PURCH.YTD nofd
    format BKAP.PURCH.LYR nofd
    mount BKAP1 type S
    if .n. read_only
       prg_hdr 'Enter/Change Vendor Information'
    else
       prg_hdr 'View Vendor Information'
    endif
    tas_notes 'Vendor','AP',ffld('bkap.vendcode','p')   && setup TASNotes
START:
    pmsg 'Recs: ',trim(str(trc(bkapvend_hndl)),'L') at 55,2 ptw S NOCR 
    upar
    new_vend=.f.
    trap f3,f4,f5,f6,f7,f8,f9,pg_dn dflt
    pmsg ccf(),"
",ccf() at 32,2
    if .n. chain_frm
        clr @bkapvend_hndl buff
        enter BKAP.VENDCODE pre setup_vend() group 1
        if BKAP.VENDCODE=  "" goto no.vend
        no_updt_rec=.t.
        findv M fnum bkapvend_hndl key BKAP.VENDCODE err NO.VEND noclr
        no_updt_rec=.f.
        fnc_list 'F1 Help,F3 Clr Rec,F4 Del Rec,PgDn Vendor Options,F10 Save','ESC Exit'
        trap F4 goto DELT.REC
        trap F3 goto CLR.REC
    else
        fnc_list 'F1 Help,PgDn Vendor Options,F10 Save','ESC Exit'
    endif
    trap pg_dn gosub dsp_purch_age
    goto ENT_VEND
NO.VEND:
       if read_only
         trap f2,f3,f4,f5,f6,f7,f8,f9,f10 ignr 
         if flerr(bkapvend_hndl)<>0
           msg 'You must input a valid vendor code.' window 'W'  
           goto start
         endif
       endif
    no_updt_rec=.f.
    pmsg ccf(),"
",ccr(),"  NEW VENDOR  ",ccf(),"
",ccf() at 32,2
    VENDCODE.HLDR =  BKAP.VENDCODE
    findv m fnum bkapvend_hndl key bkap.vendcode val 'DEFAULT   '
    clr @bkapvend_hndl rec
    BKAP.VENDCODE =  VENDCODE.HLDR
    BKAP.ACTIVE='Y'
    new_vend=.t.
    if .n. chain_frm
        fnc_list 'F1 Help,F3 Clr Record,PgDn Vendor Options,F10 Save','ESC Exit'
    else
        fnc_list 'F1 Help,PgDn Vendor Options,F10 Save','ESC Exit'
    endif
ENT_VEND:
    trap f5,f6,f7,f8,f9 ignr
    trap F10 goto SAVE.REC
    trap F2 ignr
    if read_only then trap F10 ignr 
    if .n. chain_frm .a. .n. read_only  &&AMF ADDSUM 5/28/99 add .a. .n. read_only
      enter BKAP.ACTIVE upar start dflt 'Y' mask 'YN' help ACTIVE_HELP 
      {
       ACTIVE_HELP:
          MESSAGE[1] = " Enter 'N' to make this vendor non-selectable in"
          MESSAGE[2] = " certain programs; otherwise, enter 'Y' to make this"
          MESSAGE[3] = " vendor fully active."
          msg_list msg_ptr,3
          ret
      } 
    endif
    enter BKAP.VENDNAME dflt iif(from_bkarcref,BKAR.CUSTNAME,'') pre turnon_keys() post turnoff_keys() upar START up NoClickOff
    if read_only
       if windows()
          msg 'Click on OK or press ENTER to continue.'  windows 'info'
       else
           msg 'Press a key to continue.'
       endif
       goto start
    endif
    enter BKAP.ADD1 dflt iif(from_bkarcref,BKAR.ADD1,'')
    enter BKAP.ADD2 dflt iif(from_bkarcref,BKAR.ADD2,'')
    enter BKAP.CITY pre turnon_keys() post turnoff_keys() dflt iif(from_bkarcref,BKAR.CITY,'')
    enter BKAP.STATE pre turnon_keys() post turnoff_keys() dflt iif(from_bkarcref,BKAR.STATE,'')
    enter BKAP.ZIP pre turnon_keys() post turnoff_keys() dflt iif(from_bkarcref,BKAR.ZIP,'')
    enter BKAP.COUNTRY
    enter BKAP.CONTACT dflt iif(from_bkarcref,BKAR.CONTACT,'')
    enter BKAP.TELEPHONE
    enter bkap.fax.phone
    enter bkap.your.acct
    enter bkap.comments1
    enter bkap.comments2
    enter BKAP.CLASS
    enter BKAP.START.DATE dflt date() vld chk_date()
    {
       func chk_date
         bkap.start.date=get_new_date(bkap.start.date)
         ret .t.
    }
    enter bkap.1099.type pre set_1099() post clr_1099() vld chk_1099()
    {
     func set_1099
        trap f2 gosub dsp_1099s
        fnc_list 'F2 Display 1099 Types','ESC Exit'
        ret .t.
     func clr_1099
        trap f2 dflt
        if .n. chain_frm
           fnc_list 'F1 Help,F3 Clr Record,PgDn Vendor Options,F10 Save','ESC Exit'
        else
           fnc_list 'F1 Help,PgDn Vendor Options,F10 Save','ESC Exit'
        endif
        ret .t.
     func chk_1099
        if bkap.1099.type=""
           ret .t.
        else_if bkap.1099.type="1"
           ret .t.
        else_if bkap.1099.type="2"
           ret .t.
        else_if bkap.1099.type="3"
           ret .t.
        else_if bkap.1099.type="4"
           ret .t.
        else_if bkap.1099.type="5"
           ret .t.
        else_if bkap.1099.type="6"
           ret .t.
        else_if bkap.1099.type="7"
           ret .t.
        else_if bkap.1099.type="8"
           ret .t.
        endif
        novldmsg
        msg "Please choose a valid option. Press F2 to list the options."
        ret .f.
     dsp_1099s:
        MESSAGE[1] =  " 1 - Rents"
        MESSAGE[2] =  " 2 - Royalties"
        MESSAGE[3] =  " 3 - Other income"
        MESSAGE[4] =  " 4 - Fishing Boat Proceeds"
        MESSAGE[5] =  " 5 - Medical and Health Care Payments"
        MESSAGE[6] =  " 6 - Nonemployee Compensation"
        MESSAGE[7] =  " 7 - Subst Pmts for dividends/interest"
        MESSAGE[8] =  " 8 - Crop Insurance Proceeds"
        nmenu message array at 30,15 len 10 wdt 41 cntr type nch 8 ttl "1099 Types" shd 'R' ttlw 'l' bcolor bc scolor sc ccolor cc mcolor mc box 's' auto
        if type=0
           bkap.1099.type=""
        else_if type=1
           bkap.1099.type="1"
        else_if type=2
           bkap.1099.type="2"
        else_if type=3
           bkap.1099.type="3"
        else_if type=4
           bkap.1099.type="4"
        else_if type=5
           bkap.1099.type="5"
        else_if type=6
           bkap.1099.type="6"
        else_if type=7
           bkap.1099.type="7"
        else_if type=8
           bkap.1099.type="8"
        endif
        ret
    }
    enter BKAP.1099.ID
    enter bkaP.TERMS.NUM dflt bkaP.terms.num pre ent_term() post clr_term() vld chk_term() vldm "You must enter a valid terms number."
    {
      func ent_term
      fnc_list 'F1 Help,F2 Terms,F3 Clr Record,F10 Save','ESC Exit'
      trap f2 gosub dsp_term
      ret .t.
     }
     {
     func clr_term
      fnc_list 'F1 Help,F3 Clr Record,F10 Save','ESC Exit'
      trap f2 ignr
      ret .t.
     }
     {
      dsp_term:
       if list_term(1,bksyterm_hndl,"P")<>0 then bkAP.TERMS.NUM=bksy.term.num
       ret
     }
     {
     func chk_term
      findv m fnum bksyterm_hndl key bksy.term.num val bkAP.termS.NUM
      if flerr(bksyterm_hndl)<>0 then ret .f.
      if bksy.term.use="R" ret .f.
      ret .t.
      }
    enter bkap.dflt.glact pre setup_glact('A') post clr_glact() &&AMF ADDSUM 5/1/99 remove vld chk_glact()
    enter bkap.dflt.gldpt pre setup_glact('D') post clr_glact() vld chk_glact()
SAVE.REC:
    if read_only goto start
    if BKAP.VENDCODE=  ""
        if BKSY.MSTR.VEND=  "T"
            message[1]=bkap.telephone
            cntr=1
            while cntr<=size(message[1],'a')
                ok=mid(message[1],cntr,1)
                if .n. isnum(ok)
                    delc message[1] start cntr nchr 1
                    loop
                endif
                inc cntr
            endw
            BKAP.VENDCODE =  message[1]
        else_if BKSY.MSTR.VEND=  "S"
            pusht l_exit
            trap l_exit ignr
            findv F fnum bksymstr_hndl key @0
            BKAP.VENDCODE=just(str(BKSY.MSTR.VNUM),'l')
            while .t.
                ifdup bkap.vendcode
                    inc bksy.mstr.vnum
                    bkap.vendcode=just(str(bksy.mstr.vnum),'l')
                    loop
                endif
                exit
            endw
            inc BKSY.MSTR.VNUM
            save @bksymstr_hndl nocnf noclr
            clr @bksymstr_hndl rec
            popt l_exit
        else
            gosub MAKE_CODE
        endif
    endif
    if bkap.vendcode=''
        MESSAGE[1] =  " You must assign this vendor a CODE"
        MESSAGE[2] =  " before this record can be saved"
        msg_list msg_ptr,2
        goto NO.VEND
    endif
    ask "Do you want to save this Vendor record? [Y/N] Y"
    if .n. ask() goto ENT_VEND
    if new_vend
        hold.vend = bkap.vendcode
        alloc vend_rec_hold type 'A' size rsize(bkapvend_hndl)
        xfer from BKAP.VENDCODE to vend_rec_hold nchr rsize(bkapvend_hndl)
        saves
        findv M fnum bkapvend_hndl key bkap.vendcode val hold.vend nlock
        if flerr()=0
           msg 'You have tried to enter a Vendor that has already been entered.  Another user may have just entered a Vendor with this Vendor code. ' windows 'w'
           window at 20,12 wdt 40 len 3 box 'd' shd 'r' bcolor bc wcolor wc scolor sc
           pmsg " Enter a valid Vendor " at 2,1 nocr
           upar
           enter hold.vend at 26,1 vld chk_vend2() up
             {
              func chk_vend2
                 findv M fnum bkapvend_hndl key bkap.vendcode val hold.vend nlock
                 if flerr() = 0
                    msg "This Vendor already exists! Please enter one that doesn't exist. " windows 'w'
                    novldmsg
                    ret .f.
                 endif 
              ret .t.
             }  
       endif
       xfer from vend_rec_hold to BKAP.VENDCODE nchr rsize(bkapvend_hndl)
       bkap.vendcode = hold.vend
       redsp
       scrn r
       alloc vend_rec_hold type 'A' size 1
    endif
    BKAP.NEW.VEND =  "Y"
    if chain_frm
        vend_rec_chgd=rec_changed(bkapvend_hndl)
        save @bkapvend_hndl nocnf noclr
        quit
    endif
    if new_vend
      vendcode.hldr=bkap.vendcode 
      save @bkapvend_hndl nocnf
      message[1]=' Do you want to enter a P/O for this vendor now? [Y/N]'
      ok=ent_list(msg_ptr,1,'N','YN')
    else
      ok='N'
    endif
    clr @bkappo_hndl
    if ok='Y'
        new_vend=dsp_po()
    else
        if .n. new_vend  
           vendcode.hldr=bkap.vendcode
           save @bkapvend_hndl nocnf
        else  
           ask 'Would you like to work with the vendor options menu for new vendor ' + ' '+trim(vendcode.hldr,'t')+' ? Y'
           if ask()
             findv M fnum bkapvend_hndl key BKAP.VENDCODE val vendcode.hldr
             gosub dsp_purch_age
           endif   
        endif
    endif
    goto START
DELT.REC:
    if read_only goto start
    if BKAP.OUTINV<>  0
        MESSAGE[1] =  " You may not delete a Vendor record that has an outstanding balance."
        msg_list msg_ptr,1
        goto ENT_VEND
    endif
    if BKAP.OUT.CREDIT<>  0
        MESSAGE[1] =  " You may not delete this Vendor record"
        MESSAGE[2] =  " because there are unapplied credit amounts."
        msg_list msg_ptr,2
        BKAP.VENDCODE =  VENDCODE.HLDR
        goto ENT_VEND
    endif
    ask "Do you want to delete this Vendor record? [Y/N] Y"
    if .n. ask() goto ENT_VEND
    dall @bkapcont_hndl key bkap.cont.code start bkap.vendcode while bkap.cont.code=bkap.vendcode
    dall @bkapaddr_hndl key bkap.addr.code start bkap.vendcode while bkap.addr.code=bkap.vendcode
    clr @bkapaddr_hndl
    clr @bkapcont_hndl
    del @bkapvend_hndl nocnf
    goto START
CLR.REC:
    goto START
EXIT:
    vend_rec_chgd=.f.
    clr @bkapvend_hndl buff && make sure the buffer is cleared so that if the
                            && user exits the program in this manner it doesn't
                            && return a false code to the calling program.
    quit
l_EXIT:
    no_updt_rec=.t.
    vend_rec_chgd=.f.
    clr @bkapvend_hndl buff && make sure the buffer is cleared so that if the
                            && user exits the program in this manner it doesn't
                            && return a false code to the calling program.
    quit
func setup_vend
    fnc_list 'F1 Help,F2 Display Vendors,F3 Clear Record','ESC Exit'
    trap F2 gosub DSP_VEND
    trap F10 ignr
    ret .t.
DSP_vend:
    if bksys.ap.f2="N"
      bkap.vendcode=list_vend(4,bkapvend_hndl)
    else
      bkap.vendcode=list_vend(1,bkapvend_hndl)
    endif
    ret
func turnon_keys
    if chain_frm then ret .t.
    trap f5,f6,f7,f8,f9 dflt
    ret .t.
func turnoff_keys
    trap f5,f6,f7,f8,f9 ignr
    ret .t.
do_ENT_TERMS:
    bkap.terms.num=ent_terms(bkap.terms.num)
    scrn r
    ret
define sg_wch type a size 1
func setup_glact sg_wch
    if sg_wch='D' .a. bkap.dflt.glact='' then ret .f.
    fnc_list "F1 Help,F2 Display G/L Accounts,F10 Save","ESC Exit"
    trap f2 gosub dsp_gl
    ret .t.
func clr_glact
    if .n. chain_frm
        if .n. ifna(bkapvend_hndl)
            fnc_list 'F1 Help,F3 Clr Rec,F4 Del Rec,PgDn Vendor Options,F10 Save','ESC Exit'
        else
            fnc_list 'F1 Help,F3 Clr Record,PgDn Vendor Options,F10 Save','ESC Exit'
        endif
    else
        fnc_list 'F1 Help,PgDn Vendor Options,F10 Save','ESC Exit'
    endif
    trap f2 dflt
    ret .t.
func chk_glact
    if bkap.dflt.glact='' then ret .t.    ;we don't care unless there's something here.
    BKGL.ACCT =  bkap.dflt.glact
    BKGL.GLDPT = bkap.dflt.gldpt
    findv M fnum bkglcoa_hndl key BKGL.KEY
    if bkgl.acct=''
        MESSAGE[1] =  "The G/L Account-Department entered was not found."
        MESSAGE[2] =  "You may use F2 for a menu of the Chart of Accounts."
        msg_list msg_ptr,2
        novldmsg
        ret .f.
    endif
    if .n. gl_active() then ret .f. 
    ret .t.
DSP_GL:
    if bksys.gl.f2="N"
      if list_glcoa(3,bkglcoa_hndl)<>''
        bkap.dflt.glact=BKGL.ACCT
        bkap.dflt.gldpt=BKGL.GLDPT
      endif
    else
      if list_glcoa(1,bkglcoa_hndl)<>''
        bkap.dflt.glact=BKGL.ACCT
        bkap.dflt.gldpt=BKGL.GLDPT
      endif
    endif 
    ret
MAKE_CODE:
    MESSAGE[1] =  BKAP.VENDNAME
    MCNTR2 =  25
    MCNTR3 =  6
    gosub PARSE_FLD
    BKAP.VENDCODE =  MESSAGE[2]
    MESSAGE[1] =  BKAP.STATE
    MCNTR2 =  2
    MCNTR3 =  2
    gosub PARSE_FLD
    BKAP.VENDCODE =  BKAP.VENDCODE * MESSAGE[2]
    MESSAGE[1] =  BKAP.CITY
    MCNTR2 =  15
    MCNTR3 =  2
    gosub PARSE_FLD
    BKAP.VENDCODE =  BKAP.VENDCODE * MESSAGE[2]
    bkap.vendcode=up(bkap.vendcode)
    ret
PARSE_FLD:
    MESSAGE[2] =  ""
    MCNTR4 =  0
    for(MCNTR;1;MCNTR2;1)
        if MCNTR4>=  MCNTR3 ret
        OK=MID(MESSAGE[1],MCNTR,1)
        if OK=  "." then OK =  ""
        if OK=  "'" then OK =  ""
        if OK=  "-" then OK =  ""
        if OK=  "/" then OK =  ""
        if OK=  "\" then OK =  ""
        if OK=  "&" then OK =  ""
        if OK=  " " then OK =  ""
        if OK<>  ""
            MESSAGE[2] =  MESSAGE[2] * OK
            MCNTR4 =  MCNTR4 + 1
        endif
    next
    ret
dsp_purch_age:
    saves
    xtrap_si_udc
    fnc_list '','ESC Exit'
    gosub dsp_purch_age2
    xtrap_rstr_udc
    redsp
    ret
dsp_purch_age2:
    nmenu " 1 - Current P/O's ",' 2 - P/O History ',' 3 - Aging ',' 4 - Purch by Date Range ',' 5 - Purch by Month ',' 6 - P/O Lines ',' V - Vouchers ',' C - Check History ',' R - Recurring Vouchers ','--',' 7 - Alternate Addresses ',' 8 - Alternate Contacts ' at 26,10 len 14 wdt 28 box 's' bcolor bc mcolor mc ccolor cc cntr dsp_wch shd 'r' scolor sc ttlw 'l' ttl ' Vendor Options ' auto
    if dsp_wch=0 ret
    select dsp_wch
        case 1
            gosub list_bkapapo
        case 2
            gosub open_pohist  &&AMF 5/24/00 PR
            gosub list_bkapahpo
            gosub close_pohist  &&AMF 5/24/00 PR
        case 3
            gosub list_ap_age
        case 4
            gosub open_pohist  &&AMF 5/24/00 PR
            gosub setup_bkapa4
            gosub close_pohist  &&AMF 5/24/00 PR
        case 5
            gosub open_pohist  &&AMF 5/24/00 PR
            gosub setup_bkapap2
            gosub close_pohist  &&AMF 5/24/00 PR
        case 6
            gosub open_pohist  &&AMF 5/24/00 PR
            gosub lst_lne_hst
            gosub close_pohist  &&AMF 5/24/00 PR
        case 7 
            gosub list_vouch
        case 8
            gosub chk_hist 
        case 9
            gosub list_rivl
        case 10  &&AMF ADDSUM 1/26/99 change to 10
            gosub vend_addr
        case 11  &&AMF ADDSUM 1/26/99 change to 11
            gosub vend_cont
    endc
    goto dsp_purch_age2
list_ap_age:
   if logon_scty[61]='Y'
    saves
    chain bksy.prgs.whr*'bkapg' with bkap.vendcode
    redsp
   else  &&AJF 9/4/97 was missing this else
    msg 'You do not have security level access to enter this program.' windows 'info'
   endif
   ret
func dsp_po
    if etyp()='D'
        bell
        ret .f.
    endif
    if in_bkpoa
        message[1]=" You're already in the P/O Program and can't chain to it again."
        msg_list msg_ptr,1
        ret .f.
    endif
    if logon_scty[73]='N'
       msg 'You do not have security level access to enter this program.' windows 'info'
       ret .f.      
    endif
    saves
    vendcode.hldr=bkap.vendcode
    if .n. read_only then save @bkapvend_hndl nocnf
    chain bksy.prgs.whr*'bkpoa' with bkap.po.num,vendcode.hldr
    redsp
    findv m fnum bkapvend_hndl key bkap.vendcode val vendcode.hldr
    findv m fnum bkappo_hndl key bkap.po.vndcod val bkap.vendcode
    if flerr(bkappo_hndl)<>0
        list_exit
    else
        rdlist
    endif
    clr @bkappo_hndl
    ret .f.
func dsp_hpo
    if etyp()='D'
        bell
        ret .f.
    endif
   if logon_scty[77]='Y'
    saves
    chain bksy.prgs.whr*'bkpoe' with bkap.po.num,bkap.vendcode,bkaphpo_hndl,bkaphpol_hndl  &&AMF 5/24/00 PR additional params
    redsp
   else
     msg 'You do not have security level access to enter this program.' windows 'info'
   endif
    ret .f.
func dsp_hpol
    if etyp()='D'
        bell
        ret .f.
    endif
   if logon_scty[77]='Y'
    saves
    chain bksy.prgs.whr*'bkpoe' with po_line_pon[cntr],bkap.vendcode,bkaphpo_hndl,bkaphpol_hndl  &&AMF 5/24/00 PR additional params
    redsp
   else
     msg 'You do not have security level access to enter this program.' windows 'info'
   endif
   ret .f.
lst_lne_hst:
    define po_line_prod type a size 15 array 400  &&AMF 5/30/00 ADDSUM 
    define po_line_date type d size 8 array 400
    define po_line_pon type r size 6 array 400
    define po_line_desc type a size 30 array 400
    define po_line_qty type n size 8 dec 2 array 400
    define po_line_prce type n size 10 dec 4 array 400  &&AMF 5/30/00 ADDSUM price and ext were defined with wrong size
    define po_line_ext type n size 12 dec 2 array 400
    define po_line_cntr type i
    define po_line_year type a size 1
    message[1]=' Limit search to this year only? '
    po_line_year=ent_list(msg_ptr,1,'N','YN')
    saves
    updta po_line_date,po_line_pon,po_line_desc,po_line_qty,po_line_ext,po_line_prce,po_line_prod clr  &&AMF 5/30/00 ADDSUM add po_line_prod
    msg "Please wait, checking received p/o's..." nowait
    po_line_cntr=0
    scan @bkaphpo_hndl key bkap.po.vnddte start bkap.vendcode while bkap.vendcode=bkap.po.vndcod
        scan @bkaphpol_hndl key bkap.pol.ponm start bkap.po.num while bkap.po.num=bkap.pol.ponm for up(bkap.pol.itype)<>'X' .a. iif(po_line_year='Y',bkap.pol.erd>=bksy.fiscal.yr,.t.)
            inc po_line_cntr
            po_line_date[po_line_cntr]=bkap.pol.erd
            po_line_pon[po_line_cntr]=bkap.pol.ponm
            po_line_desc[po_line_cntr]=bkap.pol.pdesc
            po_line_prce[po_line_cntr]=cprice(bkap.pol.pprce,bkap.pol.pdisc)
            po_line_qty[po_line_cntr]=bkap.pol.pqty
            po_line_ext[po_line_cntr]=bkap.pol.pext
            po_line_prod[po_line_cntr]=bkap.pol.pcode  &&AMF 5/30/00 ADDSUM
            if po_line_cntr=400
                message[1]=' There are more line items than will fit in the array.'
                message[2]=' You need to either limit the search to this year or '
                message[3]=" display the p/o's using option 2 in this menu."
                msg_list msg_ptr,3
                sexit
            endif
        ends
        sexit_if po_line_cntr=400
    ends
    if po_line_cntr=0
        redsp
        message[1]=' There are no applicable history line items for this vendor.'
        msg_list msg_ptr,1
        ret
    endif
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl ' Received Line Items for this Vendor '
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl ' Received Line Items for this Vendor '
    endif
    fnc_list 'Move cursor to view','ESC Exit'
    define poh_ttl1 type a size 110
    define poh_uscore type a size 110
 " blnes 1 enter dsp_hpol() fline poh_ttl1,poh_uscore noadd 
    setline poh_ttl1 with "Date    ","P/O # ","Product Code   ","Product Description           ","Net Price ","Qty Prch","Tot Line Amt"
    setline poh_uscore with "
    listm po_line_date,po_line_pon,po_line_prod,po_line_desc,po_line_prce,po_line_qty,po_line_ext cntr cntr maxa 400 actv po_line_cntr cbf " 
 " blnes 1 enter dsp_hpol() fline poh_ttl1,poh_uscore noadd 
    xtrap_rstr_udc
    scrn r
    redsp
    ret
    define cprice_base type n size 14 dec 4
    define cprice_disc type n size 8 dec 4
    func cprice cprice_base,cprice_disc
        if cprice_disc=0
            ret cprice_base
        else_if cprice_disc<100
            ret cprice_base*(1-(cprice_disc*0.01))
        else
            ret cprice_base*(cprice_disc*0.01)
        endif
Define FROM_DATE1,thru_date1 Type D Size 8
Define FROM_DATE2,thru_date2 Type D Size 8
Define FROM_DATE3,thru_date3 Type D Size 8
Define FROM_DATE4,thru_date4 Type D Size 8
Define purch_QTY1,purch_qty2,purch_qty3,purch_qty4 Type i size 3
define avg_purch1,avg_purch2,avg_purch3,avg_purch4 type n size 10 dec 2
Define purch_TOT_DOL1,purch_tot_dol2,purch_tot_dol3,purch_tot_dol4 Type N Size 12 Dec 2
define all_purch_qty type i size 3
Define avg_tot_purch Type N Size 10 Dec 2
Define ALL_purch_DOL Type N Size 12 Dec 2
define bkapaprc_hndl type i
setup_bkapa4:
openv 'bkapaprc.dat' type f size 32 buff from_date1 fnum bkapaprc_hndl
read bkapaprc_hndl nchr 32
close @bkapaprc_hndl
format purch_tot_dol1 nofd
format purch_tot_dol2 nofd
format purch_tot_dol3 nofd
format purch_tot_dol4 nofd
format all_purch_dol nofd
xtrap_si_udc
trap alt_f2 gosub edit_help_lines
trap f1 gosub disp_help_lines
saves
window at 5,11 box 'd' len 13 wdt 70 ttlw 'l' ttl ' Purch for this Vendor ' bcolor bc wcolor wc shd 'r' scolor sc
mount bkapa4 type s
fnc_list '','ESC Exit'
trap esc goto end_bkapa4
START_bkapa4:
    gosub init_bkapa4
    upar
    date_ptr -> from_date1
    Enter FROM_DATE1 vld do_date(from_date1)
    {
      define somedate type D size 8
      define date_ptr type F
      func do_date somedate
        &date_ptr=get_new_date(&date_ptr)
        ret .t.
    }
    date_ptr -> thru_date1
    Enter THRU_DATE1 pre from_date1<>0 dflt from_date1 vld do_date(thru_date1)
    date_ptr -> from_date2
    Enter FROM_DATE2 pre thru_date1<>0 vld do_date(from_date2)
    date_ptr -> thru_date2
    Enter THRU_DATE2 pre from_date2<>0 dflt from_date2 vld do_date(from_date2)
    date_ptr -> from_date3
    Enter FROM_DATE3 pre thru_date2<>0 vld do_date(from_date3)
    date_ptr -> thru_date3
    Enter THRU_DATE3 pre from_date3<>0 dflt from_date3 vld do_date(thru_date3)
    date_ptr -> from_date4
    Enter FROM_DATE4 pre thru_date3<>0 vld do_date(from_date4)
    date_ptr -> thru_date4
    Enter THRU_DATE4 pre from_date4<>0 dflt from_date4 vld do_date(thru_date4)
    if thru_date1<from_date1 then thru_date1=from_date1
    if thru_date2< from_date2 then thru_date2=from_date2
    if thru_date3< from_date3 then thru_date3=from_date3 
    if thru_date4< from_date4 then thru_date4=from_date4
    scan @bkaphpo_hndl key bkap.po.vndcod start bkap.vendcode while bkap.vendcode=bkap.po.vndcod
        if from_date1<>0
            if bkap.po.orddte>=from_date1 .a. bkap.po.orddte<=thru_date1
                purch_qty1=purch_qty1+1
                purch_tot_dol1=purch_tot_dol1+bkap.po.subtot
            endif
        endif
        if from_date2<>0
            if bkap.po.orddte>=from_date2 .a. bkap.po.orddte<=thru_date2
                purch_qty2=purch_qty2+1
                purch_tot_dol2=purch_tot_dol2+bkap.po.subtot
            endif
        endif
        if from_date3<>0
            if bkap.po.orddte>=from_date3 .a. bkap.po.orddte<=thru_date3
                purch_qty3=purch_qty3+1
                purch_tot_dol3=purch_tot_dol3+bkap.po.subtot
            endif
        endif
        if from_date4<>0
            if bkap.po.orddte>=from_date4 .a. bkap.po.orddte<=thru_date4
                purch_qty4=purch_qty4+1
                purch_tot_dol4=purch_tot_dol4+bkap.po.subtot
            endif
        endif
        all_purch_qty=all_purch_qty+1
        all_purch_dol=all_purch_dol+bkap.po.subtot
    ends
    avg_purch1=purch_tot_dol1/purch_qty1
    avg_purch2=purch_tot_dol2/purch_qty2
    avg_purch3=purch_tot_dol3/purch_qty3
    avg_purch4=purch_tot_dol4/purch_qty4
    avg_tot_purch=all_purch_dol/all_purch_qty
    ask 'Do you wish to print-out this data? N' dflt .f.
    if ask()
        saves
        pon a
        ? ' Purchases for vendor: ',bkap.vendcode,' ',bkap.vendname
        ? ''
        if from_date1<>0
            ? ' ',from_date1,'-',thru_date1,'  Qty: ',purch_qty1,'  Tot$: ',purch_tot_dol1,'  Avg: ',avg_purch1
            ? ''
        endif
        if from_date2<>0
            ? ' ',from_date2,'-',thru_date2,'  Qty: ',purch_qty2,'  Tot$: ',purch_tot_dol2,'  Avg: ',avg_purch2
            ? ''
        endif
        if from_date3<>0
            ? ' ',from_date3,'-',thru_date3,'  Qty: ',purch_qty3,'  Tot$: ',purch_tot_dol3,'  Avg: ',avg_purch3
            ? ''
        endif
        if from_date4<>0
            ? ' ',from_date4,'-',thru_date4,'  Qty: ',purch_qty4,'  Tot$: ',purch_tot_dol4,'  Avg: ',avg_purch4
            ? ''
        endif
        ? '   All Purchases    Qty: ',all_purch_qty,'  Tot$: ',all_purch_dol,'  Avg: ',avg_tot_purch
        if .n. Windows() then ptof
        if pwhr()='P' then exec 'BKTOF'
        pset pwhr 's'
        redsp
    endif
    goto start_bkapa4
init_bkapa4:
    purch_qty1=0 | purch_tot_dol1=0 | avg_purch1=0
    purch_qty2=0 | purch_tot_dol2=0 | avg_purch2=0
    purch_qty3=0 | purch_tot_dol3=0 | avg_purch3=0
    purch_qty4=0 | purch_tot_dol4=0 | avg_purch4=0
    all_purch_qty=0 | all_purch_dol=0 | avg_tot_purch=0
    ret
end_bkapa4:
    openv 'bkapaprc.dat' type f size 32 buff from_date1 fnum bkapaprc_hndl create noclr
    write bkapaprc_hndl nchr 32
    close @bkapaprc_hndl
    redsp
    xtrap_rstr_udc
    ret
setup_bkapap2:
    define page_num type i size 5
    define date_time_fld type a size 28
    define gross_mtd_subt,gross_totals,purch.mtd type n size 12 dec 2
    define year_long type a size 10
    define year_short type a size 4
    define found_prch type l
    define month type a size 3
    define name_hldr type a size 25
    name_hldr=just(bkap.vendname,'c')
    define months type a size 36
    months='JanFebMarAprMayJunJlyAugSepOctNovDec'
    define gross_prch_amt type n size 12 dec 2 array 60   && 5 years
    define year_array type a size 4 array 5
    saves
    pusht esc,int
    trap esc,int goto bkapap2_fini
    msg 'Please wait...Loading purch info' nowait
    updta gross_prch_amt clr
    found_prch=.f.
    scan @bkaphpo_hndl key bkap.po.vndcod start bkap.vendcode while bkap.po.vndcod=bkap.vendcode
        cntr1=(val(year(date()))-val(year(bkap.po.orddte)))+1
        cntr=ae(cntr1,mnth(bkap.po.orddte),12)
        sloop_if cntr>60            && only use the first 5 years
        gross_prch_amt[cntr]=gross_prch_amt[cntr]+bkap.po.subtot
        year_array[cntr1]=year(bkap.po.orddte)
        found_prch=.t.
    ends
    redsp       && get rid of the please wait msg
    saves       && save again for the end.
    if .n. found_prch
        msg 'There are no purchases in the history file for this vendor.'
        goto bkapap2_fini
    endif
    gosub get_df_fld
    mount bkapap2 type b pto l
    if print_cancel() goto bkapap2_fini2
    prtr_setup 'n'
    trap pg_brk gosub bkapap2_hdr
    page_num=1
    if .n. mprc_mth_hdr() goto bkapap2_fini
    gross_totals=0
    for(cntr;1;5;1)
        year_short=year_array[cntr]
        year_long='Year: '+year_short
        gross_mtd_subt=0
        for(cntr1;1;12;1)
            if gross_prch_amt[ae(cntr,cntr1,12)]<>0
                month=mid(months,((cntr1-1)*3)+1,3)
                purch.mtd=gross_prch_amt[ae(cntr,cntr1,12)]
                if .n. mprc_mth_body() goto bkapap2_fini
                gross_mtd_subt=gross_mtd_subt+purch.mtd
                year_long=''
            endif
        next
        if gross_mtd_subt<>0
            if .n. mprc_subtot() goto bkapap2_fini
            gross_totals=gross_totals+gross_mtd_subt
        endif
    next
    if .n. mprc_total() goto bkapap2_fini
bkapap2_fini:
    prtr_setup 'f'
bkapap2_fini2:
    popt int,esc
    redsp
    ret
get_df_fld:
    date_time_fld=mdy(date())+' '+ttoc(time(),7)
    date_time_fld=just(date_time_fld,'c')
    ret
    define BKAPAP2_HLL type r array 20
func mprc_mth_hdr
    pfmt 1
    pfmt 2
    pfmt 3
    pfmt 4
    pfmt 5
    pfmt 6
    pfmt 7
    updta BKAPAP2_HLL clr
    Getlbl mprc_mth_hdr Fld BKAPAP2_HLL[1]
    inc page_num
    ret .t.
func mprc_mth_body
    pfmt 8
    ret .t.
func mprc_subtot
    pfmt 9
    pfmt 10
    pfmt 11
    ret .t.
func mprc_total
    pfmt 12
    pfmt 13
    ret .t.
Func BKAPAP2_Hdr
    Define BKAPAP2_PHCntr Type I
    Define BKAPAP2_PHRet Type L
    For(BKAPAP2_PHCntr;1;20;1)
        If BKAPAP2_HLL[BKAPAP2_PHCntr]<>0
            Gosubl BKAPAP2_HLL[BKAPAP2_PHCntr]
            BKAPAP2_PHRet=Retval()
            If .n. BKAPAP2_PHRet then Ret .F.
        Endif
    Next
    Ret BKAPAP2_PHRet
list_BKAPAPO:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " Current P/O's for this Vendor "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " Current P/O's for this Vendor "
    endif
    if in_bkpoa
        fnc_list '','ESC Exit'
    else
        fnc_list 'Move cursor/press ENTER to View/Change,INSERT Add New','ESC Exit'
    endif
    define BKAPAPO_ttl1 type a size 367
    define BKAPAPO_uscore type a size 367
    setline BKAPAPO_ttl1 with "P/O Num","Ord Date","Ord Desc                      ","Ord Total   ","Ship To Code","Ship To Name                  ","Ship To Add1                  ","Ship To Add2                  ","Ship To City   ","Ship To St","Ship To Zip","Terms     ","Ent By","Ordered For","Tax?","Tax Rate","Subtot      ","Tax Amt     ","Amt Recv Not Yet Inv","Printed?"
    setline BKAPAPO_uscore with "
    listf str(BKAP.PO.NUM)+fill(1," "), BKAP.PO.ORDDTE, BKAP.PO.DESC, bkap.po.total, BKAP.PO.SHPCOD+fill(2," "), BKAP.PO.SHPNME, BKAP.PO.SHPA1, BKAP.PO.SHPA2, BKAP.PO.SHPCTY, BKAP.PO.SHPST+fill(8," "), BKAP.PO.SHPZIP+fill(1," "), BKAP.PO.TERMD, BKAP.PO.ENTBY+" ", BKAP.PO.OBYCUS+fill(1," "), BKAP.PO.TAXABLE+fill(3," "), str(BKAP.PO.TAXRTE)+fill(3," "), BKAP.PO.SUBTOT, str(BKAP.PO.TAXAMT)+fill(4," "), str(BKAP.PO.RNI.D)+fill(8," "), BKAP.PO.PRTD+fill(7," ") file @BKAPPO_HNDL start bkap.vendcode while bkap.po.vndcod=bkap.vendcode cbf " 
 " blnes 1 enter dsp_po() key BKAP.PO.VNDDTE fline BKAPAPO_ttl1,BKAPAPO_uscore end
    xtrap_rstr_udc
    redsp
    scrn r
    ret
list_BKAPAHPO:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " Received P/O's for this Vendor "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " Received P/O's for this Vendor "
    endif
    fnc_list 'Move cursor/press ENTER to View','ESC Exit'
    define BKAPAHPO_ttl1 type a size 367
    define BKAPAHPO_uscore type a size 367
    setline BKAPAHPO_ttl1 with "P/O Num","Ord Date","Ord Desc                      ","Ship To Code","Ship To Name                  ","Ship To Add1                  ","Ship To Add2                  ","Ship To City   ","Ship To St","Ship To Zip","Terms     ","Ent By","Ordered For","Tax?","Tax Rate","Subtot      ","Tax Amt     ","Ord Total   ","Amt Recv Not Yet Inv","Printed?"
    setline BKAPAHPO_uscore with "
    listf str(BKAP.PO.NUM)+fill(1," "), BKAP.PO.ORDDTE, BKAP.PO.DESC, BKAP.PO.SHPCOD+fill(2," "), BKAP.PO.SHPNME, BKAP.PO.SHPA1, BKAP.PO.SHPA2, BKAP.PO.SHPCTY, BKAP.PO.SHPST+fill(8," "), BKAP.PO.SHPZIP+fill(1," "), BKAP.PO.TERMD, BKAP.PO.ENTBY+fill(1," "), BKAP.PO.OBYCUS+fill(1," "), BKAP.PO.TAXABLE+fill(3," "), str(BKAP.PO.TAXRTE)+fill(3," "), BKAP.PO.SUBTOT, str(BKAP.PO.TAXAMT)+fill(4," "), BKAP.PO.TOTAL, str(BKAP.PO.RNI.D)+fill(8," "), BKAP.PO.PRTD+fill(7," ") file @BKAPHPO_HNDL start bkap.vendcode while bkap.po.vndcod=bkap.vendcode cbf " 
 " blnes 1 enter dsp_hpo() noadd key BKAP.PO.VNDDTE fline BKAPAHPO_ttl1,BKAPAHPO_uscore end 
    xtrap_rstr_udc
    redsp
    ret
vend_addr:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 wcolor wc  box 'D' bcolor bc shd 'r' ttlw 'L' ttl " Enter/Change/Delete Addresses "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'D' bcolor bc ttlw 'L' ttl " Enter/Change/Delete Addresses "
    endif
    fnc_list 'Move cursor/press ENTER to Change,INSERT Add New,DELETE','ESC Exit'
    define bkapADDR_ttl1 type a size 241
    setline bkapADDR_ttl1 with "Name                          ","Address Line 1                ","Address Line 2                ","City           ","State","Zip Code  ","Country                       ","Use for comment          "
    define bkapADDR_uscore type a size 241
    setline bkapADDR_uscore with "
    listf bkap.ADDR.NAME, bkap.ADDR.ADD1, bkap.ADDR.ADD2, bkap.ADDR.CITY, bkap.ADDR.STATE+fill(3," "), bkap.ADDR.ZIP, bkap.country, bkap.addr.com file @bkapADDR_HNDL start bkap.vendcode  while bkap.addr.code=bkap.vendcode cbf " 
 " blnes 1 enter enter_addr() key bkap.addr.code fline bkapADDR_ttl1,bkapADDR_uscore ins_at_end
    xtrap_rstr_udc
    redsp
    clr @bkapaddr_hndl
    ret
    func enter_addr
        if etyp()='D'
            ask ' Are you sure you want to delete this address? Y'
            ret ask()
        endif
        xtrap_si_udc
        trap esc goto ent_addr_exit
        trap f10 goto ent_addr_save
        saves
        window at 36,12 len 12 wdt 45 wcolor wc() box 'D' bcolor bc() shd iif(windows(),'r','n') ttlw 'l' ttl ' Enter/Modify this Address ' use_colors
        fnc_list 'F10 Save','ESC Return to List'
        mount bkapaddr type s
        upar
        enter bkap.addr.name dflt iif(ifna(bkapaddr_hndl),bkap.vendname,'')
        enter bkap.addr.add1 dflt iif(ifna(bkapaddr_hndl),bkap.add1,'')
        enter bkap.addr.add2 dflt iif(ifna(bkapaddr_hndl),bkap.add2,'')
        enter bkap.addr.city dflt iif(ifna(bkapaddr_hndl),bkap.city,'')
        enter bkap.addr.state dflt iif(ifna(bkapaddr_hndl),bkap.state,'')
        enter bkap.addr.zip dflt iif(ifna(bkapaddr_hndl),bkap.zip,'')
        enter bkap.addr.cntry dflt iif(ifna(bkapaddr_hndl),bkap.country,'')
        enter bkap.addr.com
        ent_addr_save:
        bkap.addr.code=bkap.vendcode
        xtrap_rstr_udc
        redsp
        if bkap.addr.name=''
            message[1]='You must enter at least a name to create a new alternate address rec'
            msg_list msg_ptr,1
            ret .f.
        endif
        ret .t.
        ent_addr_exit:
            if rec_changed(bkapaddr_hndl)
                if ask_update2('Vendor Address File')
                    bkap.addr.code=bkap.vendcode
                    xtrap_rstr_udc
                    redsp
                    ret .t.
                endif
            endif
            xtrap_rstr_udc
            redsp
            ret .f.
vend_cont:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 wcolor wc  box 'D' bcolor bc shd 'r' ttlw 'L' ttl " Enter/Change/Delete Contacts "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'D' bcolor bc ttlw 'L' ttl " Enter/Change/Delete Contacts "
    endif
    fnc_list 'Move cursor/press ENTER to Change,INSERT Add New,DELETE','ESC Exit'
    define vendCONT_ttl1 type a size 124
    setline vendCONT_ttl1 with "Name                     ","Contact Location/Title   ","Telephone Num            ","Fax Phone Num            "
    define vendCONT_uscore type a size 124
    setline vendCONT_uscore with "
    listf bkap.CONT.NAME, bkap.CONT.LOC, bkap.CONT.PHONE, bkap.CONT.FAX file @bkapCONT_HNDL start bkap.vendcode while bkap.cont.code=bkap.vendcode cbf " 
 " blnes 1 enter enter_cont() key bkap.cont.code fline vendCONT_ttl1,vendCONT_uscore ins_at_end
    xtrap_rstr_udc
    redsp
    clr @bkapcont_hndl
    ret
    func enter_cont
        if etyp()='D'
            ask ' Are you sure you want to delete this contact? Y'
            ret ask()
        endif
        xtrap_si_udc
        trap esc goto ent_cont_exit
        trap f10 goto ent_cont_save
        saves
        window at 35,13 len 8 wdt 46 wcolor wc() box 'D' bcolor bc() shd iif(windows(),'r','n') ttlw 'l' ttl ' Enter/Modify this Contact ' use_colors
        fnc_list 'F10 Save','ESC Return to List'
        mount bkapcont type s
        upar
        enter bkap.cont.name
        enter bkap.cont.phone
        enter bkap.cont.fax
        enter bkap.cont.loc
        ent_cont_save:
        bkap.cont.code=bkap.vendcode
        xtrap_rstr_udc
        redsp
        if bkap.cont.name=''
            message[1]='You must enter at least a name to create a new alternate contact rec'
            msg_list msg_ptr,1
            ret .f.
        endif
        ret .t.
        ent_cont_exit:
            if rec_changed(bkapcont_hndl)
                if ask_update2('Vendor Contact File')
                    bkap.cont.code=bkap.vendcode
                    xtrap_rstr_udc
                    redsp
                    ret .t.
                endif
            endif
            xtrap_rstr_udc
            redsp
            ret .f.
bkapvend_clbl:
    if bkap.vendcode='' .o. bkap.vendname='' .o. bkap.add1=''
        no_chk=.t.
    endif
    ret
bkapaddr_clbl:
    if bkap.addr.name='' .o. bkap.addr.add1=''
        no_chk=.t.
    endif
    ret
bkapcont_clbl:
    if bkap.cont.name='' then no_chk=.t.
    ret
do_print:       ;NOTE:  These lines are just to resolve a label in ADV50.OBJ.
    ret         ;       Do not remove them.
open_pohist:
    list_poarchive
    openv HPOFILE lock n fnum bkaphpo_hndl
    openv HPOLFILE lock n fnum bkaphpol_hndl
    ret
close_pohist:
   close @bkaphpo_hndl  
   close @bkaphpol_hndl  
   ret
list_vouch:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 box 'S' shd 'R' ttlw 'L' ttl " A/P Vouchers "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " A/P Vouchers "
    endif
    fnc_list 'Move cursor to view','ESC Exit'
    define apvouch_ttl1 type a size 110
    setline apvouch_ttl1 with "Inv Date","Due Date","Inv Num   ","Description              ","Type      ","Total Amount "
    define apvouch_uscore type a size 110
    setline apvouch_uscore with "
    listf dtoc(bkap.invl.date), dtoc(bkap.invl.duedt), bkap.invl.num, bkap.invl.desc, bkap.invl.typed, bkap.invl.tamt file @bkapinvl_hndl start bkap.vendcode while bkap.invl.code=bkap.vendcode cbf " 
 " blnes 1 key bkap.invl.code fline apvouch_ttl1,apvouch_uscore end
    xtrap_rstr_udc
    redsp
    scrn r
    ret
chk_hist:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 box 'S' shd 'R' ttlw 'L' ttl " A/P Payment History "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " A/P Payment History "
    endif
    fnc_list 'Move cursor to view','ESC Exit'
    define chkh_ttl1 type a size 130
    setline chkh_ttl1 with "Chk Date","Inv Date","Inv Num   ","Description              ","Chk Num","Acct","Invoice Amt ","Amount Paid " 
    define chkh_uscore type a size 130
    setline chkh_uscore with "
    listf dtoc(bkap.chk.chkdte), dtoc(bkap.chk.invdte),bkap.chk.invnum, bkap.chk.desc, str(bkap.chk.num)+fill(1," "), str(bkap.chk.chkact)+fill(2," "), bkap.chk.invamt, bkap.chk.amtpd file @bkapchkh_hndl start bkap.vendcode while bkap.chk.vndcod=bkap.vendcode cbf " 
 " blnes 1 key bkap.chk.vnddte fline chkh_ttl1,chkh_uscore end
    xtrap_rstr_udc
    redsp
    scrn r
    ret
    ret
list_rivl:
    saves
    xtrap_si_udc
    if windows()
      window at 2,15 len 10 wdt 78 box 'S' shd 'R' ttlw 'L' ttl " Recurring Vouchers for this Vendor "
    else
      window at 1,15 len 10 wdt 80 wcolor wc  box 'S' bcolor bc shd 'R' scolor sc ttlw 'L' ttl " Recurring Vouchers for this Vendor "
    endif
    fnc_list 'Move cursor to view','ESC Exit'
    define RRAP_ttl1 type a size 110
    setline RRAP_ttl1 with "Num       ","Description              ","Type      ","Freq","Max","Next Date","Total Amount "
    define RRAP_uscore type a size 110
    setline RRAP_uscore with "
    listf bkap.invl.num, bkap.invl.desc, bkap.invl.typed, str(mid(bkap.invl.termd,2,2))+fill(2," "), str(mid(bkap.invl.termd,4,2))+fill(1," "), dtoc(bkap.invl.date)+fill(1," "), bkap.invl.tamt file @bkaprivl_hndl start bkap.vendcode while bkap.invl.code=bkap.vendcode cbf " 
 " blnes 1 key bkap.invl.code fline RRAP_ttl1,RRAP_uscore 
    xtrap_rstr_udc
    redsp
    scrn r
    ret
\S5BKAP1
  1Y  YSSREC_+name    SDREC_+name    SCREC_+name    NONE          NONE          YNN
 Code: 
  Active? 
     Contact: 
 Name: 
       Phone: 
 Add1: 
         Fax: 
 Add2: 
   Your Acct: 
  CSZ: 
    Prch YTD: 
 Ctry: 
         LYR: 
 Rmks: 
 Class  Start     1099    Tax ID Number     Terms           Dflt G/L Acct     
 Crdts: 
 Inv: 
 Lst Prch: 
 Lst Pmt: 
\COLOR
  1  1  1  2 80
  1  3  1  3 80
  1  4  1 25 80
\FIELDS
BKAP.VENDCODE    0  9  3  0  0 0   10    0    0AYRGBKAPVEND      10
BKAP.ACTIVE      0 29  3  0  0 0    1    0    0AYRGBKAPVENDNN     1
DISP_ONLY        0 34  3 17  0 0    5    0    0XNXGMEMORY  NN     5        ==Achk_for_notes()
BKAP.CONTACT     0 53  3  0  0 0   25    0    0ANRGBKAPVEND      25
BKAP.VENDNAME    0  9  4  0  0 0   30    0    0ANRGBKAPVENDNN    30
BKAP.TELEPHONE   0 53  4  0  0 0   25    0    0ANRGBKAPVEND      25
BKAP.ADD1        0  9  5  0  0 0   30    0    0ANRGBKAPVENDNN    30
BKAP.FAX.PHONE   0 53  5  0  0 0   25    0    0AYRGBKAPVENDNN    25
BKAP.ADD2        0  9  6  0  0 0   30    0    0ANRGBKAPVENDNN    30
BKAP.YOUR.ACCT   0 53  6  0  0 0   25    0    0AYRGBKAPVENDNN    25
BKAP.CITY        0  9  7  0  0 0   15    0    0ANRGBKAPVEND      15
BKAP.STATE       0 25  7  0  0 0    2    0    0AYRGBKAPVEND       2
BKAP.ZIP         0 29  7  0  0 0   10    0    0AYRGBKAPVEND      10
BKAP.PURCH.YTD   0 53  7  0  0 2   12    0    0NNRGBKAPVENDNN    12
BKAP.COUNTRY     0  9  8  0  0 0   30    0    0AYRGBKAPVENDNN    30
BKAP.PURCH.LYR   0 53  8  0  0 2   12    0    0NNRGBKAPVENDNN    12
BKAP.COMMENTS1   0  9 10  0  0 0   69    0    0ANRGBKAPVENDNN    69
BKAP.COMMENTS2   0  9 11  0  0 0   69    0    0ANRGBKAPVENDNN    69
BKAP.CLASS       0  3 14  0  0 0    2    0    0AYRGBKAPVEND       2
BKAP.START.DATE  0 10 14  0  0 0    8    0    0DNRGBKAPVEND       8
BKAP.1099.TYPE   0 22 14  0  0 0    1    0    0AYRGBKAPVENDNN     1
BKAP.1099.ID     0 28 14  0  0 0   15    0    0AYRGBKAPVENDNN    15
BKAP.TERMS.NUM   0 47 14  0  0 0    3    0    0INRGBKAPVENDNN     3
BKAP.DFLT.GLACT  0 62 14  0  0 0   10    0    0AYRGBKAPVENDNN    10
BKAP.DFLT.GLDPT  0 73 14  0  0 0    4    0    0AYRGBKAPVENDNN     4
BKAP.OUT.CREDIT  0 10 16  0  0 2   12    0    0NNRGBKAPVENDNN    12
BKAP.OUTINV      0 28 16  0  0 2   12    0    0NNRGBKAPVENDNN    12
BKAP.LASTPURCH   0 51 16  0  0 0    8    0    0DNRGBKAPVENDNN     8
BKAP.LASTPMT     0 69 16  0  0 0    8    0    0DNRGBKAPVENDNN     8
\FILES
BKAPVENDBKAPVEND 28
\INCLUDE
\KEY
\S5BKAPA4
  1Y  YSSREC_+name    SDREC_+name    SCREC_+name    NONE          NONE          DNN
 Display Purchases By Date Range
   From       Thru      Num Orders   Total Dollars   Avg Purch
 All Purchases             
 Press ESC to return to Main Vendor Screen
\COLOR
\FIELDS
FROM_DATE1       0  2  5  0  0 0    8    0    0DNRGMEMORY  NN     8
THRU_DATE1       0 13  5  0  0 0    8    0    0DNRGMEMORY  NN     8
PURCH_QTY1       0 28  5  0  0 2    3    0    0INRGMEMORY  NN     3
PURCH_TOT_DOL1   0 38  5  0  0 2   12    0    0NNRGMEMORY  NN    12
AVG_PURCH1       0 54  5  0  0 2   10    0    0NNRGMEMORY  NN    10
FROM_DATE2       0  2  6  0  0 0    8    0    0DNRGMEMORY  NN     8
THRU_DATE2       0 13  6  0  0 0    8    0    0DNRGMEMORY  NN     8
PURCH_QTY2       0 28  6  0  0 0    3    0    0INRGMEMORY  NN     3
PURCH_TOT_DOL2   0 38  6  0  0 2   12    0    0NNRGMEMORY  NN    12
AVG_PURCH2       0 54  6  0  0 2   10    0    0NNRGMEMORY  NN    10
FROM_DATE3       0  2  7  0  0 0    8    0    0DNRGMEMORY  NN     8
THRU_DATE3       0 13  7  0  0 0    8    0    0DNRGMEMORY  NN     8
PURCH_QTY3       0 28  7  0  0 0    3    0    0INRGMEMORY  NN     3
PURCH_TOT_DOL3   0 38  7  0  0 2   12    0    0NNRGMEMORY  NN    12
AVG_PURCH3       0 54  7  0  0 2   10    0    0NNRGMEMORY  NN    10
FROM_DATE4       0  2  8  0  0 0    8    0    0DNRGMEMORY  NN     8
THRU_DATE4       0 13  8  0  0 0    8    0    0DNRGMEMORY  NN     8
PURCH_QTY4       0 28  8  0  0 0    3    0    0INRGMEMORY  NN     3
PURCH_TOT_DOL4   0 38  8  0  0 2   12    0    0NNRGMEMORY  NN    12
AVG_PURCH4       0 54  8  0  0 2   10    0    0NNRGMEMORY  NN    10
ALL_PURCH_QTY    0 28  9  0  0 0    3    0    0INRGMEMORY  NN     3
ALL_PURCH_DOL    0 38  9  0  0 2   12    0    0NNRGMEMORY  NN    12
AVG_TOT_PURCH    0 54  9  0  0 2   10    0    0NNRGMEMORY  NN    10
\FILES
                  0
\INCLUDE
\KEY
\B5BKAPAP2
 31 80100 5 18BKARAS2 NNN!
mprc_mth_hdr  ------------------------------------------------------------------mprc_mth_hdr                                                                    mprc_mth_hdr                                                                    mprc_mth_hdr   
                                Purch by Month                      Page: 
                            Month    Gross Sales
                            -----    ------------
mprc_mth_body ------------------------------------------------------------------mprc_mth_body                                                                   mprc_mth_body                                                                   mprc_mth_body  
mprc_subtot   ------------------------------------------------------------------mprc_subtot                                                                     mprc_subtot                                                                     mprc_subtot    
                                     ------------
                            Mth Tot: 
mprc_total    ------------------------------------------------------------------mprc_total                                                                      mprc_total                                                                      mprc_total     
                                     ============
                            Rpt Tot: 
Report End ---------------------------------------------------------------------Report End                                                                      Report End                                                                      Report End     
\COLOR
  0  1  1  1 80
  1  2  8  1 80
  0  9  9  1 80
  1 10 10  1 80
  0 11 11  1 80
  1 12 14  1 80
  0 15 15  1 80
  1 16 17  1 80
  0 18 18  1 80
  1 19100  1 80
\FIELDS
PAGE_NUM           75  2  0 0      5    0    0I     NMEMORY                                          R
BKAP.VENDCODE      35  3  0 0     10    0    0A      BKAPVEND                                        R
NAME_HLDR          27  4  0 0     25    0    0A     NMEMORY                                          R
DATE_TIME_FLD      26  5  0 0     28    0    0A     NMEMORY                                          R
YEAR_LONG          16 10  0 0     10    0    0A     NMEMORY                                          R
MONTH              29 10  0 0      3    0    0A     NMEMORY                                          R
PURCH.MTD          38 10  0 2     12    0    0NN     MEMORY                                          R
GROSS_MTD_SUBT     38 13  0 2     12    0    0NN    NMEMORY                                          R
GROSS_TOTALS       38 17  0 2     12    0    0NN    NMEMORY                                          R
\EXP_BLK
 1                                                                                                                                inc page_num
\IF_PRT
\PG_HDR
 1NN 0                                                                                                                                mprc_mth_hdr
 2NN 0
 4NN 0
 5NN 0
\NAMES_BLK
 1mprc_mth_hdr
 2mprc_mth_body
 4mprc_subtot
 5mprc_total
\INIT_EXP
\S5BKAPCONT
  5Y  YSSREC_+name    SDREC_+name    SCREC_+name    NONE          NONE          YNN
  Contact Name:  
 Telephone Num:  
 Fax Phone Num:  
     Loc/Title:  
\COLOR
  5  1  1 25 80
\FIELDS
BKAP.CONT.NAME   0 18  2  0  0 0   25    0    0ANRGBKAPCONTNN    25
BKAP.CONT.PHONE  0 18  3  0  0 0   25    0    0AYRGBKAPCONTNN    25
BKAP.CONT.FAX    0 18  4  0  0 0   25    0    0AYRGBKAPCONTNN    25
BKAP.CONT.LOC    0 18  5  0  0 0   25    0    0ANRGBKAPCONTNN    25
\FILES
BKAPCONTBKAPCONT  4
\INCLUDE
\KEY
BKAPCONT
\S5BKAPADDR
  5Y  YSSREC_+name    SDREC_+name    SCREC_+name    NONE          NONE          YNN
  Name: 
  Add1: 
  Add2: 
   CSZ: 
 Cntry: 
  Use for: 
\COLOR
  5  1  1 25 80
\FIELDS
BKAP.ADDR.NAME   0  9  2  0  0 0   30    0    0ANRGBKAPADDRNN    30
BKAP.ADDR.ADD1   0  9  3  0  0 0   30    0    0ANRGBKAPADDRNN    30
BKAP.ADDR.ADD2   0  9  4  0  0 0   30    0    0ANRGBKAPADDRNN    30
BKAP.ADDR.CITY   0  9  5  0  0 0   15    0    0ANRGBKAPADDRNN    15
BKAP.ADDR.STATE  0 25  5  0  0 0    2    0    0AYRGBKAPADDRNN     2
BKAP.ADDR.ZIP    0 29  5  0  0 0   10    0    0AYRGBKAPADDRNN    10
BKAP.ADDR.CNTRY  0  9  6  0  0 0   30    0    0ANRGBKAPADDRNN    30
BKAP.ADDR.COM    0 12  8  0  0 0   25    0    0ANRGBKAPADDRNN    25
\FILES
BKAPADDRBKAPADDR  8
\INCLUDE
\KEY
